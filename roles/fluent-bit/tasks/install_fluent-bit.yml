---
- name: Install fluentbit repo
  ansible.builtin.yum_repository:
    name: fluent-bit
    baseurl:
      - https://packages.fluentbit.io/centos/$releasever/
    enabled: true
    gpgcheck: true
    gpgkey:
      - https://packages.fluentbit.io/fluentbit.key
    state: present
    description: 'Fluent Bit'
    repo_gpgcheck: true

- name: Install fluentbit
  ansible.builtin.dnf:
    name:
      - fluent-bit
    update_cache: true
    state: present
    enablerepo: Fluent Bit
  notify: Start fluent-bit

- name: Copy parsers
  ansible.builtin.copy:
    src: nginx_parsers.conf
    dest: /etc/fluent-bit/nginx_parsers.conf
    owner: root
    mode: '644'
  notify: Restart fluent-bit

- name: Install fluentbit repo
  ansible.builtin.template:
    src: fluent-bit.conf
    dest: /etc/fluent-bit/fluent-bit.conf
    mode: '644'
    owner: root
  notify: Restart fluent-bit
